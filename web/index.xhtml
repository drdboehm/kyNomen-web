<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/templates/template.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:pf="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ky="http://com.kynomics/kynomen"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <ui:define name="bodyContent">
        <h:panelGrid columns="2" styleClass="table-valign">
            <h:form id="halterForm">
                <pf:panel header="Halter-Formular" style="width: 350px;">
                    <h:messages styleClass="errorMsg"></h:messages>
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:outputLabel for="inHalterId" value="*#{msgs.halter_id}" />   
                        <h:inputText label="#{msgs.halter_id}" 
                                     id="inHalterId" 
                                     value="#{halterController.halter.halterId}" 
                                     pt:placeholder="Halter-Id">
                        </h:inputText>

                        <h:outputLabel for="inHalterName" value="*#{msgs.halter_name}" />   
                        <h:inputText label="#{msgs.halter_name}" 
                                     id="inHalterName" 
                                     value="#{halterController.halter.halterName}" 
                                     pt:placeholder="Halter-Name"
                                     validator="#{halterController.validateAlpha}">
                        </h:inputText>

                        <h:outputLabel for="inHalterBemerkung" value="*#{msgs.halter_bemerkung}" />   
                        <h:inputText label="#{msgs.halter_bemerkung}" 
                                     id="inHalterBemerkung" 
                                     value="#{halterController.halter.halterBemerkung}" 
                                     pt:placeholder="Bemerkung"
                                     validator="#{halterController.validateAlphaNumeric}">
                        </h:inputText>

                        <h:outputText  value="#{msgs.halter_haltertyp}"/>
                        <h:selectOneMenu id="inHalterTyp" value="#{halterController.haltertyp.haltertypId}" >
                            <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                            <f:selectItems value="#{halterController.alleHalterTypenMap}"/>
                        </h:selectOneMenu>

                        <h:commandButton id="sucheHalterButton" value="Suche Halter" 
                                         action="#{halterController.sucheHalter()}"/>
                        <h:commandButton id="saveHalterButton" action="#{halterController.saveHalter()}" 
                                         value="Halter speichern"/>
                    </h:panelGrid>
                </pf:panel>
            </h:form>
            <h:form id="halterSelect">
                <pf:dataTable id="halterTbl" paginator="true" rows="5" paginatorPosition="bottom" paginatorAlwaysVisible="false" 
                              widgetVar="halterTable" filteredValue="#{halterController.filteredHalterList}" emptyMessage="#{msgs.halter_empty_message}" 
                              style="width: 900px; height: 280px" value="#{halterController.alleHalter}" stickyHeader="true" var="halter">
                    <f:facet name="header">
                        <pf:outputPanel>
                            Liste der Halter -   
                            <h:outputText value="Gesamtsuche: "/>
                            <pf:inputText id="globalFilter" onkeyup="halterTable.filter()" style="width: 150px" /> 
                        </pf:outputPanel>  
                    </f:facet>  
                    <pf:column style="width: 35px" headerText="#{msgs.halter_id}">
                        <h:outputText value="#{halter.halterId}"></h:outputText>
                    </pf:column>
                    <pf:column style="width: 150px" filterBy="#{halter.halterName}" filterMatchMode="contains" headerText="#{msgs.halter_name}">
                        <h:outputText value="#{halter.halterName}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 450px" filterBy="#{halter.halterBemerkung}" filterMatchMode="contains" headerText="#{msgs.halter_bemerkung}">
                        <h:outputText value="#{halter.halterBemerkung}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.halter_haltertyp}">
                        <h:outputText value="#{halter.haltertypId.haltertypName}"> </h:outputText>
                    </pf:column>
                    <f:facet name="footer">Anzahl Halter: #{fn:length(halterController.halterList)}</f:facet> 
                </pf:dataTable>
            </h:form>
            <h:form id="patientForm">
                <pf:panel header="Patienten-Formular" style="width: 350px;">
                    <h:messages styleClass="errorMsg"></h:messages>
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:outputLabel for="inPatientId" value="*#{msgs.patient_id}" />   
                        <h:inputText label="#{msgs.patient_id}" 
                                     id="inPatientId" 
                                     value="#{halterController.patient.patientId}" 
                                     pt:placeholder="Patienten-Id">
                        </h:inputText>
                        <h:outputLabel for="inPatientRufName" value="*#{msgs.patient_rufname}" />   
                        <h:inputText label="#{msgs.patient_rufname}" 
                                     id="inPatientRufName" 
                                     value="#{halterController.patient.patientRuf}" 
                                     pt:placeholder="Patienten-Rufname">
                        </h:inputText>

                        <h:outputLabel for="inPatientName" value="*#{msgs.patient_vollstaendiger_name}" />   
                        <h:inputText label="#{msgs.patient_vollstaendiger_name}" 
                                     id="inPatientName" 
                                     value="#{halterController.patient.patientName}" 
                                     pt:placeholder="vollstÃ¤ndiger Name">
                        </h:inputText>

                        <h:outputLabel for="inPatientChipNr" value="*#{msgs.patient_chipnr}" />   
                        <h:inputText label="#{msgs.patient_chipnr}" 
                                     id="inPatientChipNr" 
                                     value="#{halterController.patient.patientChip}" 
                                     pt:placeholder="Chip-Nr.">
                        </h:inputText>

                        <h:outputLabel for="inPatientTatooNr" value="*#{msgs.patient_tatoonr}" />   
                        <h:inputText label="#{msgs.patient_tatoonr}" 
                                     id="inPatientTatooNr" 
                                     value="#{halterController.patient.patientTatoonr}" 
                                     pt:placeholder="Tatoo-Nr.">
                        </h:inputText>

                        <h:outputLabel for="inPatientZuchtBuchNr" value="*#{msgs.patient_zuchtbuchnr}" />   
                        <h:inputText label="#{msgs.patient_zuchtbuchnr}" 
                                     id="inPatientZuchtBuchNr" 
                                     value="#{halterController.patient.patientZuchtbuchnr}" 
                                     pt:placeholder="Zuchtbuch-Nr.">
                        </h:inputText>

                        <h:outputLabel for="inPatientGebDat" value="#{msgs.patient_geburtstag}" />   
                        <h:inputText label="#{msgs.patient_geburtstag}" 
                                     id="inPatientGebDat" 
                                     value="#{halterController.patient.patientGeb}" 
                                     pt:placeholder="dd.mm.yyyy">
                            <f:convertDateTime pattern="dd.MM.yyyy" />
                            <ky:validateAge maxAge="20"/>   
                        </h:inputText>
                        <h:panelGroup></h:panelGroup>
                        <h:outputText value="#{ky:getAge(halterController.patient.patientGeb)} Jahre"/>

                        <h:outputText  value="#{msgs.patient_spezies}"/>
                        <h:selectOneMenu id="inSpezies" value="#{halterController.spezies.speziesId}"  >
                            <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                            <f:selectItems value="#{halterController.alleSpeziesTypenMap}"/>
                            <f:ajax listener="#{halterController.getAlleRasseTypenMap()}" 
                                    render="inRasse"/>
                        </h:selectOneMenu>   


                        <h:outputText  value="#{msgs.patient_rasse}"/>
                        <h:selectOneMenu id="inRasse" value="#{halterController.rasse.rasseId}" >
                            <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                            <f:selectItems value="#{halterController.alleRasseTypenMap}"/>
                            <f:ajax listener="#{halterController.getAlleSpeziesTypenMap()}" 
                                    render="inSpezies"/>
                        </h:selectOneMenu>  
                        <h:commandButton id="suchePatientButton" action="#{halterController.suchePatient()}" value="Suche Patient"/>
                        <h:commandButton id="savePatientButton" action="#{halterController.savePatient()}" value="Patient speichern"/>
                    </h:panelGrid>
                </pf:panel>
            </h:form> 
            <h:form id="patientSelect">
                <pf:dataTable paginator="true" rows="5" paginatorPosition="bottom" paginatorAlwaysVisible="false"  style="width: 900px;" value="#{halterController.patientList}" stickyHeader="true" var="p">
                    <pf:column style="width: 35px" headerText="#{msgs.patient_id}">
                        <h:outputText value="#{p.patientId}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 55px" headerText="#{msgs.patient_rufname}">
                        <h:outputText value="#{p.patientRuf}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 95px" headerText="#{msgs.patient_vollstaendiger_name}">
                        <h:outputText value="#{p.patientName}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 55px" headerText="#{msgs.patient_chipnr}">
                        <h:outputText value="#{p.patientChip}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 55px"  headerText="#{msgs.patient_tatoonr}">
                        <h:outputText value="#{p.patientTatoonr}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 85px" headerText="#{msgs.patient_zuchtbuchnr}">
                        <h:outputText value="#{p.patientZuchtbuchnr}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 75px" headerText="#{msgs.patient_geburtstag}">
                        <h:outputText value="#{p.patientGeb}"> 
                            <f:convertDateTime pattern="dd.MM.yyyy" />
                        </h:outputText>
                    </pf:column>
                    <pf:column style="width: 45px" headerText="#{msgs.patient_alter}">
                        <h:outputText value="#{ky:getAge(p.patientGeb)} Jahre"/>
                    </pf:column>
                    <pf:column style="width: 75px" headerText="#{msgs.patient_rasse}">
                        <h:outputText value="#{p.rasseRasseId.rasseName}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 45px" headerText="#{msgs.patient_spezies}">
                        <h:outputText value="#{p.rasseRasseId.speziesSpeziesId.speziesName}"> </h:outputText>
                    </pf:column>
                    <pf:column style="width: 35px" headerText="#{msgs.halter_id}">
                        <h:outputText value="#{p.halterHalterId.halterId}"> </h:outputText>
                    </pf:column>
                    <f:facet name="footer">Anzahl Patienten: #{fn:length(halterController.patientList)}</f:facet> 
                </pf:dataTable>
            </h:form>
            <h:form id="adressForm">
                <pf:panel header="Adress-Formular" style="width: 350px;">
                    <h:messages styleClass="errorMsg"></h:messages>
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:outputLabel for="inHalterAdresseId" value="*#{msgs.adress_id}" />   
                        <h:inputText label="#{msgs.adress_strasse_hausnr}" 
                                     id="inHalterAdresseId" 
                                     value="#{halterController.halteradresse.halteradresseId}" 
                                     pt:placeholder="Adress-Id">
                        </h:inputText>

                        <h:outputText  value="#{msgs.adress_adresstyp}"/>
                        <h:selectOneMenu id="inAdressTyp" value="#{halterController.adressTyp.adresstypId}" >
                            <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                            <f:selectItems value="#{halterController.alleAdressTypenMap}"/>
                        </h:selectOneMenu>

                        <h:outputLabel for="inHalterAdresseStrasse" value="*#{msgs.adress_strasse_hausnr}" />   
                        <h:inputText label="#{msgs.adress_strasse_hausnr}" 
                                     id="inHalterAdresseStrasse" 
                                     value="#{halterController.halteradresse.halterStrasse}" 
                                     pt:placeholder="Strasse + Haus-Nr">
                        </h:inputText>

                        <h:outputLabel for="inHalterAdressePlz" value="*#{msgs.adress_plz}" />   
                        <h:inputText label="#{msgs.adress_plz}" 
                                     id="inHalterAdressePlz" 
                                     value="#{halterController.halteradresse.halterPlz}" 
                                     pt:placeholder="Postleitzahl">
                            <!--<ky:convertZipCode/>-->
                            <!--<f:converter converterId="com.kynomics.ZipCodeConverter"/>-->
                        </h:inputText>

                        <h:outputLabel for="inHalterAdresseOrt" value="*#{msgs.adress_ort}" />   
                        <h:inputText label="#{msgs.adress_ort}" 
                                     id="inHalterAdresseOrt" 
                                     value="#{halterController.halteradresse.halterOrt}" 
                                     pt:placeholder="Ort">
                        </h:inputText>

                        <h:outputLabel for="inHalterAdresseTel" value="*#{msgs.adress_tel}" />   
                        <h:inputText label="#{msgs.adress_tel}" 
                                     id="inHalterAdresseTel" 
                                     value="#{halterController.halteradresse.halterTel}" 
                                     pt:placeholder="Vorwahl / Telefon-Nr.">
                        </h:inputText>

                        <h:outputLabel for="inHalterAdresseEMail" value="*#{msgs.adress_email}" />   
                        <h:inputText label="#{msgs.adress_email}" 
                                     id="inHalterAdresseEMail" 
                                     value="#{halterController.halteradresse.email}" 
                                     pt:placeholder="EMail-Adresse" >
                            <!--                    <f:validateLength minimum="2" maximum="30"/>
                                                <f:validator validatorId="emailValidator" />-->
                        </h:inputText>

                        <h:commandButton id="sucheAdressButton" action="#{halterController.sucheAdresse()}" value="Suche Adresse"/>
                        <h:commandButton id="saveAdressrButton" action="#{halterController.saveAdresse()}" value="Adresse speichern"/>
                    </h:panelGrid>
                </pf:panel>
            </h:form>
            <h:form id="adressSelect">
                <pf:dataTable paginator="true" rows="5" paginatorPosition="bottom" paginatorAlwaysVisible="false"  style="width: 900px;" value="#{halterController.halteradresseList}" var="ha" stickyHeader="true">
                    <pf:column headerText="#{msgs.adress_id}">
                        <h:outputText value="#{ha.halteradresseId}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.adress_adresstyp}">
                        <h:outputText value="#{ha.adresstypId.adresstypName}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.adress_strasse_hausnr}">
                        <h:outputText value="#{ha.halterStrasse}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.adress_plz}">
                        <h:outputText value="#{ha.halterPlz}"> </h:outputText>
                    </pf:column>

                    <pf:column headerText="#{msgs.adress_ort}">
                        <h:outputText value="#{ha.halterOrt}"> </h:outputText>
                    </pf:column>

                    <pf:column headerText="#{msgs.adress_tel}">
                        <h:outputText value="#{ha.halterTel}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.adress_email}">
                        <h:outputText value="#{ha.email}"> </h:outputText>
                    </pf:column>
                    <pf:column headerText="#{msgs.halter_id}">
                        <h:outputText value="#{ha.halterId.halterId}"> </h:outputText>
                    </pf:column>
                    <f:facet name="footer">Anzahl Adressen: #{fn:length(halterController.halteradresseList)}</f:facet> 
                </pf:dataTable>
            </h:form>
        </h:panelGrid>
    </ui:define>
</ui:composition>

