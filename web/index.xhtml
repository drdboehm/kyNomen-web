<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/templates/template.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ky="http://com.kynomics/kynomen"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">


    <ui:define name="bodyContent">
        <h:panelGrid columns="2" styleClass="table-valign">
            <h:form id="halterForm">
                <h:messages styleClass="errorMsg"></h:messages>
                <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                    <f:facet name="header">Halter-Formular</f:facet> 
                    <h:commandButton value="#{msgs.menu_reset}" action="#{halterController.resetLists()}"/>
                    <h:panelGroup></h:panelGroup> 
                    <h:outputLabel for="inHalterId" value="*#{msgs.halter_id}" />   
                    <h:inputText label="#{msgs.halter_id}" 
                                 id="inHalterId" 
                                 value="#{halterController.currentHalter.halterId}" 
                                 p:placeholder="Halter-Id">
                    </h:inputText>

                    <h:outputLabel for="inHalterName" value="*#{msgs.halter_name}" />   
                    <h:inputText label="#{msgs.halter_name}" 
                                 id="inHalterName" 
                                 value="#{halterController.currentHalter.halterName}" 
                                 p:placeholder="Halter-Name"
                                 validator="#{halterController.validateAlpha}">
                    </h:inputText>

                    <h:outputLabel for="inHalterBemerkung" value="*#{msgs.halter_bemerkung}" />   
                    <h:inputText label="#{msgs.halter_bemerkung}" 
                                 id="inHalterBemerkung" 
                                 value="#{halterController.currentHalter.halterBemerkung}" 
                                 p:placeholder="Bemerkung"
                                 validator="#{halterController.validateAlphaNumeric}">
                    </h:inputText>

                    <h:outputText  value="#{msgs.halter_haltertyp}"/>
                    <h:selectOneMenu id="inHalterTyp" value="#{halterController.haltertyp.haltertypId}" >
                        <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                        <f:selectItems value="#{halterController.alleHalterTypenMap}"/>
                    </h:selectOneMenu>

                    <h:commandButton id="sucheHalterButton" value="Suche Halter" 
                                     action="#{halterController.sucheHalter()}"/>
                    <h:commandButton id="saveHalterButton" action="#{halterController.saveHalter()}" 
                                     value="Halter speichern"/>
                </h:panelGrid>
            </h:form>
            <h:form id="halterSelect">
                <h:dataTable style="width: 900px;" value="#{halterController.halterList}" 
                             var="halter" >
                    <f:facet name="header">Liste der Halter</f:facet> 
                    <h:column>
                        <f:facet name="header">
                            #{msgs.halter_id} - 
                            <h:commandButton id="halterIdSort" value="Sort" action="#{halterController.sortHalterById()}"/>
                        </f:facet>
                        <h:outputText value="#{halter.halterId}"></h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msgs.halter_name} -
                            <h:commandButton value="Sort" action="#{halterController.sortHalterByName()}"/>
                        </f:facet>
                        <h:outputText value="#{halter.halterName}" rendered="#{not halter.edited}"> </h:outputText>
                        <h:inputText value="#{halter.halterName}" rendered="#{halter.edited}"></h:inputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msgs.halter_bemerkung} -
                            <h:commandButton value="Sort" action="#{halterController.sortHalterByBemerkung()}"/>
                        </f:facet>
                        <h:outputText value="#{halter.halterBemerkung}"  rendered="#{not halter.edited}"> </h:outputText>
                        <h:inputText value="#{halter.halterBemerkung}"  rendered="#{halter.edited}"> </h:inputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">#{msgs.halter_haltertyp}</f:facet>
                        <h:outputText value="#{halter.haltertypId.haltertypName}" rendered="#{not halter.edited}"> </h:outputText>
                        <h:selectOneMenu id="inHalterTyp" value="#{halterController.haltertyp.haltertypId}" rendered="#{halter.edited}">
                            <f:selectItems value="#{halterController.alleHalterTypenMap}" />
                        </h:selectOneMenu>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Ändern</f:facet>
                        <h:commandButton value="Ändern" action="#{halterController.editEntity(halter)}" rendered="#{not halter.edited}"/>
                        <h:commandButton value="Speichern" action="#{halterController.saveHalter(halter)}" rendered="#{halter.edited}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Löschen</f:facet>
                        <h:commandButton value="Löschen" action="#{halterController.deleteHalter(halter.halterId)}"/>
                    </h:column>
                    <f:facet name="footer">Anzahl Halter: #{fn:length(halterController.halterList)}</f:facet> 
                </h:dataTable>
            </h:form>
            <h:form id="patientForm">
                <!--<pf:panel header="Patienten-Formular" style="width: 350px;">-->
                <h:messages styleClass="errorMsg"></h:messages>
                <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                    <f:facet name="header">Patienten-Formular</f:facet>
                    <h:outputLabel for="inPatientId" value="*#{msgs.patient_id}" />   
                    <h:inputText label="#{msgs.patient_id}" 
                                 id="inPatientId" 
                                 value="#{halterController.currentPatient.patientId}" 
                                 p:placeholder="Patienten-Id">
                    </h:inputText>
                    <h:outputLabel for="inPatientRufName" value="*#{msgs.patient_rufname}" />   
                    <h:inputText label="#{msgs.patient_rufname}" 
                                 id="inPatientRufName" 
                                 value="#{halterController.currentPatient.patientRuf}" 
                                 p:placeholder="Patienten-Rufname">
                    </h:inputText>

                    <h:outputLabel for="inPatientName" value="*#{msgs.patient_vollstaendiger_name}" />   
                    <h:inputText label="#{msgs.patient_vollstaendiger_name}" 
                                 id="inPatientName" 
                                 value="#{halterController.currentPatient.patientName}" 
                                 p:placeholder="vollständiger Name">
                    </h:inputText>

                    <h:outputLabel for="inPatientChipNr" value="*#{msgs.patient_chipnr}" />   
                    <h:inputText label="#{msgs.patient_chipnr}" 
                                 id="inPatientChipNr" 
                                 value="#{halterController.currentPatient.patientChip}" 
                                 p:placeholder="Chip-Nr.">
                    </h:inputText>

                    <h:outputLabel for="inPatientTatooNr" value="*#{msgs.patient_tatoonr}" />   
                    <h:inputText label="#{msgs.patient_tatoonr}" 
                                 id="inPatientTatooNr" 
                                 value="#{halterController.currentPatient.patientTatoonr}" 
                                 p:placeholder="Tatoo-Nr.">
                    </h:inputText>

                    <h:outputLabel for="inPatientZuchtBuchNr" value="*#{msgs.patient_zuchtbuchnr}" />   
                    <h:inputText label="#{msgs.patient_zuchtbuchnr}" 
                                 id="inPatientZuchtBuchNr" 
                                 value="#{halterController.currentPatient.patientZuchtbuchnr}" 
                                 p:placeholder="Zuchtbuch-Nr.">
                    </h:inputText>

                    <h:outputLabel for="inPatientGebDat" value="#{msgs.patient_geburtstag}" />   
                    <h:inputText label="#{msgs.patient_geburtstag}" 
                                 id="inPatientGebDat" 
                                 value="#{halterController.currentPatient.patientGeb}" 
                                 p:placeholder="dd.mm.yyyy">
                        <f:convertDateTime pattern="dd.MM.yyyy" />
                        <ky:validateAge maxAge="20"/>   
                    </h:inputText>
                    <h:panelGroup></h:panelGroup>
                    <h:outputText value="#{ky:getAge(halterController.currentPatient.patientGeb)} Jahre"/>

                    <h:outputText  value="#{msgs.patient_spezies}"/>
                    <h:selectOneMenu id="inSpezies" value="#{halterController.spezies.speziesId}"  >
                        <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                        <f:selectItems value="#{halterController.alleSpeziesTypenMap}"/>
                        <f:ajax listener="#{halterController.getAlleRasseTypenMap()}" 
                                render="inRasse"/>
                    </h:selectOneMenu>   


                    <h:outputText  value="#{msgs.patient_rasse}"/>
                    <h:selectOneMenu id="inRasse" value="#{halterController.rasse.rasseId}" >
                        <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                        <f:selectItems value="#{halterController.alleRasseTypenMap}"/>
                        <f:ajax listener="#{halterController.getAlleSpeziesTypenMap()}" 
                                render="inSpezies"/>
                    </h:selectOneMenu>  
                    <h:commandButton id="suchePatientButton" action="#{halterController.suchePatient()}" value="Suche Patient"/>
                    <h:commandButton id="savePatientButton" action="#{halterController.savePatient()}" value="Patient speichern"/>
                </h:panelGrid>
                <!--</pf:panel>-->
            </h:form> 
            <h:form id="patientSelect">
                <h:dataTable style="width: 900px;" value="#{halterController.patientList}" var="p">
                    <f:facet name="header">Liste der Patienten</f:facet> 
                    <h:column>
                        <f:facet  name="header">
                            #{msgs.patient_id}
                        </f:facet> 
                        <h:outputText value="#{p.patientId}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_rufname}
                        </f:facet>
                        <h:outputText value="#{p.patientRuf}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_vollstaendiger_name}
                        </f:facet>
                        <h:outputText value="#{p.patientName}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_chipnr}
                        </f:facet> 
                        <h:outputText value="#{p.patientChip}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_tatoonr}
                        </f:facet>
                        <h:outputText value="#{p.patientTatoonr}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_zuchtbuchnr}
                        </f:facet>
                        <h:outputText value="#{p.patientZuchtbuchnr}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_geburtstag}
                        </f:facet>
                        <h:outputText value="#{p.patientGeb}"> 
                            <f:convertDateTime pattern="dd. MMM yyyy" />
                        </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_alter}
                        </f:facet>
                        <h:outputText value="#{ky:getAge(p.patientGeb)} Jahre"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_rasse}
                        </f:facet>
                        <h:outputText value="#{p.rasseRasseId.rasseName}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.patient_spezies}
                        </f:facet>
                        <h:outputText value="#{p.rasseRasseId.speziesSpeziesId.speziesName}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.halter_id}
                        </f:facet>
                        <h:outputText value="#{p.halterHalterId.halterId}"> </h:outputText>
                    </h:column>
                    <f:facet name="footer">Anzahl Patienten: 
                        #{fn:length(halterController.patientList)}</f:facet> 
                </h:dataTable>
            </h:form>
            <h:form id="adressForm">
                <h:messages styleClass="errorMsg"></h:messages>
                <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                    <f:facet name="header">Adress-Formular</f:facet> 
                    <h:outputLabel for="inHalterAdresseId" value="*#{msgs.adress_id}" />   
                    <h:inputText label="#{msgs.adress_strasse_hausnr}" 
                                 id="inHalterAdresseId" 
                                 value="#{halterController.halteradresse.halteradresseId}" 
                                 p:placeholder="Adress-Id">
                    </h:inputText>

                    <h:outputText  value="#{msgs.adress_adresstyp}"/>
                    <h:selectOneMenu id="inAdressTyp" value="#{halterController.adressTyp.adresstypId}" >
                        <f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
                        <f:selectItems value="#{halterController.alleAdressTypenMap}"/>
                    </h:selectOneMenu>

                    <h:outputLabel for="inHalterAdresseStrasse" value="*#{msgs.adress_strasse_hausnr}" />   
                    <h:inputText label="#{msgs.adress_strasse_hausnr}" 
                                 id="inHalterAdresseStrasse" 
                                 value="#{halterController.halteradresse.halterStrasse}" 
                                 p:placeholder="Strasse + Haus-Nr">
                    </h:inputText>

                    <h:outputLabel for="inHalterAdressePlz" value="*#{msgs.adress_plz}" />   
                    <h:inputText label="#{msgs.adress_plz}" 
                                 id="inHalterAdressePlz" 
                                 value="#{halterController.halteradresse.halterPlz}" 
                                 p:placeholder="Postleitzahl">
                        <!--<ky:convertZipCode/>-->
                        <!--<f:converter converterId="com.kynomics.ZipCodeConverter"/>-->
                    </h:inputText>

                    <h:outputLabel for="inHalterAdresseOrt" value="*#{msgs.adress_ort}" />   
                    <h:inputText label="#{msgs.adress_ort}" 
                                 id="inHalterAdresseOrt" 
                                 value="#{halterController.halteradresse.halterOrt}" 
                                 p:placeholder="Ort">
                    </h:inputText>

                    <h:outputLabel for="inHalterAdresseTel" value="*#{msgs.adress_tel}" />   
                    <h:inputText label="#{msgs.adress_tel}" 
                                 id="inHalterAdresseTel" 
                                 value="#{halterController.halteradresse.halterTel}" 
                                 p:placeholder="Vorwahl / Telefon-Nr.">
                    </h:inputText>

                    <h:outputLabel for="inHalterAdresseEMail" value="*#{msgs.adress_email}" />   
                    <h:inputText label="#{msgs.adress_email}" 
                                 id="inHalterAdresseEMail" 
                                 value="#{halterController.halteradresse.email}" 
                                 p:placeholder="EMail-Adresse" >
                        <!--                    <f:validateLength minimum="2" maximum="30"/>
                                            <f:validator validatorId="emailValidator" />-->
                    </h:inputText>

                    <h:commandButton id="sucheAdressButton" action="#{halterController.sucheAdresse()}" value="Suche Adresse"/>
                    <h:commandButton id="saveAdressrButton" action="#{halterController.saveAdresse()}" value="Adresse speichern"/>
                </h:panelGrid>
            </h:form>
            <h:form id="adressSelect">
                <h:dataTable style="width: 900px;" value="#{halterController.halteradresseList}" var="ha">
                     <f:facet name="header">Liste der Adressen</f:facet> 
                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_id}
                        </f:facet>
                        <h:outputText value="#{ha.halteradresseId}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_adresstyp}
                        </f:facet>
                        <h:outputText value="#{ha.adresstypId.adresstypName}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_strasse_hausnr}
                        </f:facet>
                        <h:outputText value="#{ha.halterStrasse}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_plz}
                        </f:facet>
                        <h:outputText value="#{ha.halterPlz}"> </h:outputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_ort}
                        </f:facet>
                        <h:outputText value="#{ha.halterOrt}"> </h:outputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_tel}
                        </f:facet>
                        <h:outputText value="#{ha.halterTel}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.adress_email}
                        </f:facet>
                        <h:outputText value="#{ha.email}"> </h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            #{msgs.halter_id}
                        </f:facet>
                        <h:outputText value="#{ha.halterId.halterId}"> </h:outputText>
                    </h:column>
                    <f:facet name="footer">Anzahl Adressen: 
                        #{fn:length(halterController.halteradresseList)}</f:facet>
                </h:dataTable>
            </h:form>
        </h:panelGrid>
    </ui:define>
</ui:composition>

