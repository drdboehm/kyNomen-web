<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/templates/template.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ky="http://com.kynomics/kynomen"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:pf="http://primefaces.org/ui">

    <ui:define name="bodyContent">
        <h:panelGrid columns="2" styleClass="table-valign">
            <h:form id="uTypForm">
                <pf:panel header="#{msgs.header_form_utyp}" style="width: 350px;">
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:panelGroup></h:panelGroup> 
                        <h:commandButton value="#{msgs.menu_reset}" 
                                         action="#{uTypController.resetLists(uTypController.utypList, uTypController.milestoneList)}">
                            <f:actionListener binding="#{uTypController.resetCurrents(uTypController.currentUTyp, uTypController.currentMilestone)}"/>

                        </h:commandButton>
                        <h:outputLabel for="inUntersuchungsTypId" value="*#{msgs.uTyp_id}" />   
                        <h:inputText label="#{msgs.uTyp_id}" 
                                     id="inUntersuchungsTypId" 
                                     value="#{uTypController.currentUTyp.untersuchungtypId}" 
                                     p:placeholder="Untersuchungstyp-Id">
                        </h:inputText>
                        <h:outputLabel for="inUntersuchungsTypName" value="*#{msgs.uTyp_name}" />   
                        <h:inputText label="#{msgs.uTyp_name}" 
                                     id="inUntersuchungsTypName" 
                                     value="#{uTypController.currentUTyp.untersuchungtypName}" 
                                     p:placeholder="Bezeichnung"
                                     validator="#{uTypController.validateUTyp}"  >
                        </h:inputText>
                        <h:panelGroup></h:panelGroup> 
                        <h:message for="inUntersuchungsTypName" styleClass="errorMsg"/>
                        <h:outputLabel for="inUntersuchungsTypGen" value="*#{msgs.uTyp_gen}" />   
                        <h:inputText label="#{msgs.uTyp_gen}" 
                                     id="inUntersuchungsTypGen" 
                                     value="#{uTypController.currentUTyp.untersuchungtypGen}" 
                                     p:placeholder="Genname"
                                     validator="#{uTypController.validateUTyp}"  >
                        </h:inputText>
                        <h:panelGroup></h:panelGroup> 
                        <h:message for="inUntersuchungsTypGen" styleClass="errorMsg"/>
                        <h:outputLabel for="inUntersuchungsTypMut" value="*#{msgs.uTyp_mut}" />   
                        <h:inputText label="#{msgs.uTyp_mut}" 
                                     id="inUntersuchungsTypMut" 
                                     value="#{uTypController.currentUTyp.untersuchungtypMut}" 
                                     p:placeholder="Mutation" 
                                     validator="#{uTypController.validateUTyp}">
                        </h:inputText>
                        <h:panelGroup></h:panelGroup> 
                        <h:message for="inUntersuchungsTypMut" styleClass="errorMsg"/>
                        <h:commandButton id="saveUTypButton" action="#{uTypController.saveUTyp()}" 
                                         value="#{msgs.button_save}"/>
                        <h:commandButton id="sucheUTypButton" value="#{msgs.button_search}" 
                                         action="#{uTypController.sucheUTyp()}"/>
                    </h:panelGrid>
                </pf:panel>
            </h:form>
            <h:form id="uTypSelect">
                <pf:panel header="#{msgs.header_list_utypen}" footer="#{msgs.footer_anzahl_utypen} #{fn:length(uTypController.utypList)}">
                    <pf:dataTable stickyHeader="true" scrollable="true" scrollHeight="200"  
                                   style="width: 900px;" value="#{uTypController.utypList}" var="utyp" >
                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.header_list_de_select}</f:facet>
                            <h:commandButton value="#{utyp.untersuchungtypId}" action="#{uTypController.selectUTyp(utyp)}" rendered="#{not utyp.selected}" />
                            <h:commandButton value="#{msgs.mark_selected}#{utyp.untersuchungtypId}" action="#{uTypController.deSelectUTyp(utyp)}" rendered="#{utyp.selected}" />
                            <f:facet name="footer">
                                <h:commandButton id="uTypIdSort" value="#{msgs.button_sort}" action="#{uTypController.sortUTypById()}"/>
                            </f:facet>
                        </pf:column>

                        <pf:column  style="width: 24%">
                            <f:facet name="header">#{msgs.uTyp_name}</f:facet>
                            <f:facet name="footer">
                                <h:commandButton value="#{msgs.button_sort}" action="#{uTypController.sortUTypByName()}"/>
                            </f:facet>
                            <h:outputText value="#{utyp.untersuchungtypName}" rendered="#{not utyp.edited}"> </h:outputText>
                            <h:inputText value="#{utyp.untersuchungtypName}" rendered="#{utyp.edited}"></h:inputText>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.uTyp_gen}</f:facet>
                            <f:facet name="footer">
                                <h:commandButton value="#{msgs.button_sort}" action="#{uTypController.sortUTypByGen()}"/>
                            </f:facet>
                            <h:outputText value="#{utyp.untersuchungtypGen}"  rendered="#{not utyp.edited}"> </h:outputText>
                            <h:inputText value="#{utyp.untersuchungtypGen}"  rendered="#{utyp.edited}"> </h:inputText>
                        </pf:column>
                        <pf:column style="width: 20%">
                            <f:facet name="header">#{msgs.uTyp_mut}</f:facet>
                            <f:facet name="footer">
                                <h:commandButton value="#{msgs.button_sort}" action="#{uTypController.sortUTypByMut()}"/>
                            </f:facet>
                            <h:outputText value="#{utyp.untersuchungtypMut}"  rendered="#{not utyp.edited}"> </h:outputText>
                            <h:inputText value="#{utyp.untersuchungtypMut}"  rendered="#{utyp.edited}"> </h:inputText>
                        </pf:column>
                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.button_edit}</f:facet>
                            <h:commandButton value="#{msgs.button_edit}" action="#{uTypController.editUTyp(utyp)}" rendered="#{not utyp.edited}"/>
                            <h:commandButton value="#{msgs.button_save}" action="#{uTypController.saveUTyp(utyp)}" rendered="#{utyp.edited}"/>
                        </pf:column>
                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.button_delete}</f:facet>
                            <h:commandButton onclick="if (!confirm('#{msgs.uTyp_confirm_message}'))
                                        return false" value="#{msgs.button_delete}" action="#{uTypController.deleteUTyp(utyp.untersuchungtypId)}"/>
                        </pf:column>
                    </pf:dataTable>
                </pf:panel>
            </h:form>

            <h:form id="uSOPForm">
                <pf:panel header="#{msgs.header_form_SOP}" style="width: 350px;">
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:panelGroup></h:panelGroup> 
                        <h:commandButton value="#{msgs.SOPList_clear}" action="#{uTypController.clearSOPList()}"/>
                        <h:panelGroup></h:panelGroup> 
                        <h:commandButton value="#{msgs.SOPList_save}" action="#{uTypController.saveSOPList(uTypController.milestoneOrderedSOPList)}"/>
                    </h:panelGrid>
                    <h:dataTable value="#{uTypController.utypList}" var="utyp">
                        <h:column>
                            <f:facet name="header">#{msgs.uTyp_id}</f:facet>
                            <h:outputText value="#{utyp.untersuchungtypId}" rendered="#{utyp.selected}"/>
                            <f:facet name="footer">
                            </f:facet>
                        </h:column>
                        <h:column>
                            <f:facet name="header">#{msgs.uTyp_name}</f:facet>
                            <h:outputText value="#{utyp.untersuchungtypName}" rendered="#{utyp.selected}"/>
                            <f:facet name="footer">
                            </f:facet>
                        </h:column>
                        <h:column>
                            <f:facet name="header">#{msgs.uTyp_gen}</f:facet>
                            <h:outputText value="#{utyp.untersuchungtypGen}" rendered="#{utyp.selected}"/>
                            <f:facet name="footer">
                            </f:facet>
                        </h:column>
                    </h:dataTable>
                </pf:panel>

                <pf:panel  header="#{msgs.header_form_untersuchung}" style="width: 350px;">
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:outputLabel for="inUntersuchungName" value="#{msgs.untersuchung_name}"/>   
                        <h:outputText id="inUntersuchungName" 
                                      style="width: 200px"
                                      value="#{uTypController.currentUTyp.untersuchungtypName}" >
                        </h:outputText>
                        <h:outputLabel for="inUTypMinDauer" value="#{msgs.untersuchung_min_dauer}"/>   
                        <h:outputText id="inUTypMinDauer" 
                                      style="width: 50px"
                                      value="#{uTypController.sumMsAllTimes()/60/8}"> 
                            <f:convertNumber pattern="#0" integerOnly="true"/>
                        </h:outputText>
                        <h:outputLabel for="inUntersuchungDauer" value="#{msgs.untersuchung_dauer}"/>   
                        <h:inputText   label="#{msgs.untersuchung_dauer}" 
                                       id="inUntersuchungDauer" 
                                       style="width: 50px"
                                       value="#{uTypController.currentUntersuchung.untersuchungDauer}"> 
                            <f:convertNumber pattern="#0" integerOnly="true"/>
                        </h:inputText>
                        <h:outputLabel for="inUTypMinCost" value="#{msgs.untersuchung_min_preis}"/>   
                        <h:outputText id="inUTypMinCost" 
                                      style="width: 50px"
                                      value="#{uTypController.sumMsCost()}"> 
                            <f:convertNumber pattern="#0.00" currencySymbol="€"/>
                        </h:outputText>
                        <h:outputLabel for="inUTypMinManHour" value="#{msgs.untersuchung_min_manhour}"/>   
                        <h:outputText id="inUTypMinManHour" 
                                      style="width: 50px"
                                      value="#{uTypController.sumMsManHour()/60}"> 
                            <f:convertNumber pattern="#0.00" />
                        </h:outputText>


                        <h:outputLabel for="inUntersuchungPreis" value="#{msgs.untersuchung_preis}"/>   
                        <h:inputText   label="#{msgs.untersuchung_preis}" 
                                       id="inUntersuchungPreis" 
                                       style="width: 50px"
                                       value="#{uTypController.currentUntersuchung.untersuchungPreis}"> 
                            <f:convertNumber pattern="#0.00" currencySymbol="€"/>
                        </h:inputText>
                        <h:panelGroup></h:panelGroup> 
                        <h:commandButton value="#{msgs.button_untersuchung_save}" action="#{uTypController.saveUntersuchung()}"/>
                    </h:panelGrid>
                </pf:panel> 
            </h:form>
            <h:form id="uSOPSelectedOrderedList">
                <pf:panel header="#{msgs.header_list_SOPs}" footer="#{msgs.footer_anzahl_SOPsteps} #{fn:length(uTypController.milestoneOrderedSOPList)}">
                    <pf:dataTable stickyHeader="true"  scrollable="true" scrollHeight="200" 
                                  draggableRows="true" 
                                  style="width: 900px;" value="#{uTypController.milestoneOrderedSOPList}" var="ms" >
                        <pf:column  style="width: 6%">
                            <f:facet name="header">Id</f:facet>
                            <h:outputText value="#{ms.milestoneId}" />
                            <f:facet name="footer">
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 14%">
                            <f:facet name="header">#{msgs.milestone_name}</f:facet>
                            <f:facet name="footer">
                            </f:facet>
                            <h:outputText value="#{ms.milestoneName}"> </h:outputText>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_alltime}</f:facet>
                            <f:facet name="footer">#{uTypController.sumMsAllTimes()}</f:facet>
                            <h:outputText value="#{ms.milestoneAlltime}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_handsontime}</f:facet>
                            <f:facet name="footer">#{uTypController.sumMsHandsonTimes()}</f:facet>
                            <h:outputText value="#{ms.milestoneAlltime}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_manhour}</f:facet>
                            <f:facet name="footer">#{uTypController.sumMsManHour()}</f:facet>
                            <h:outputText value="#{ms.milestoneManhour}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_cost}</f:facet>
                            <f:facet name="footer">#{uTypController.sumMsCost()}</f:facet>
                            <h:outputText value="#{ms.milestonecost}">
                                <!--conversion do not work here, because ms.milestonecost is a String property -->
                                <!--<f:convertNumber pattern="#0.00" currencySymbol="€"/>-->
                            </h:outputText>
                        </pf:column>

                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.button_delete}</f:facet>
                            <h:commandButton value="#{msgs.button_delete}" action="#{uTypController.removeMSFromOrderedSOPList(ms)}"/>
                        </pf:column>

                    </pf:dataTable>
                </pf:panel>
            </h:form>
            <h:form id="milestoneForm">
                <pf:panel header="#{msgs.header_form_milestone}" style="width: 350px;">
                    <h:panelGrid columns="2" columnClasses="rightAlign, leftAlign">
                        <h:outputLabel for="inMilestoneId" value="*#{msgs.milestone_id}"/>   
                        <h:inputText label="#{msgs.milestone_id}" 
                                     id="inMilestoneId" 
                                     value="#{uTypController.currentMilestone.milestoneId}" 
                                     p:placeholder="Milestone-Id">
                        </h:inputText>
                        <h:outputLabel for="inMilestoneName" value="*#{msgs.milestone_name}" />   
                        <h:inputText label="#{msgs.milestone_name}" 
                                     id="inMilestoneName" 
                                     value="#{uTypController.currentMilestone.milestoneName}" 
                                     p:placeholder="Milestone-Name"
                                     validator="#{uTypController.validateMilestone}">
                        </h:inputText>
                        <h:panelGroup></h:panelGroup> 
                        <h:message for="inMilestoneName" styleClass="errorMsg"/>

                        <h:outputLabel for="inMilestoneAlltime" value="#{msgs.milestone_alltime}" />   
                        <h:inputText label="#{msgs.milestone_alltime}" 
                                     id="inMilestoneAlltime" 
                                     value="#{uTypController.currentMilestone.milestoneAlltime}" 
                                     p:placeholder="hh:mm">
                            <f:convertDateTime pattern="HH:mm"  timeZone="GMT+1" />
                        </h:inputText>

                        <h:outputLabel for="inMilestoneHandsontime" value="#{msgs.milestone_handsontime}" />   
                        <h:inputText label="#{msgs.milestone_handsontime}" 
                                     id="inMilestoneHandsontime" 
                                     value="#{uTypController.currentMilestone.milestoneHandsontime}" 
                                     p:placeholder="hh:mm">
                            <f:convertDateTime pattern="HH:mm"  timeZone="GMT+1" />
                        </h:inputText>

                        <h:outputLabel for="inMilestoneMannumber" value="#{msgs.milestone_mannumber}" />   
                        <h:inputText label="#{msgs.milestone_mannumber}" 
                                     id="inMilestoneMannumber" 
                                     value="#{uTypController.currentMilestone.milestoneMannumber}" 
                                     p:placeholder="Anzahl">    
                        </h:inputText>

                        <h:outputLabel for="inMilestoneManhour" value="#{msgs.milestone_manhour}" />   
                        <h:inputText label="#{msgs.milestone_manhour}" 
                                     id="inMilestoneManhour" 
                                     value="#{uTypController.currentMilestone.milestoneManhour}" 
                                     p:placeholder="hh:mm">
                            <f:convertDateTime pattern="HH:mm"  timeZone="GMT+1" />
                        </h:inputText>

                        <h:outputLabel for="inMilestoneCost" value="#{msgs.milestone_cost}" />   
                        <h:inputText label="#{msgs.milestone_cost}" 
                                     id="inMilestoneCost" 
                                     value="#{uTypController.currentMilestone.milestonecost}" 
                                     p:placeholder="Preis €">
                        </h:inputText>

                        <h:outputText  value="#{msgs.milestonetyp}"/>
                        <h:selectOneMenu label="#{msgs.milestonetyp_select_one}" id="inMilestoneTyp" 
                                         value="#{uTypController.milestonetyp.milestonetypId}"  
                                         validator="#{uTypController.validateMilestone}">
                            <f:selectItem itemValue="#{null}" itemLabel="#{msgs.menu_select_one}"/>
                            <f:selectItems value="#{uTypController.alleMilestoneTypenMap}"/>
                        </h:selectOneMenu>
                        <h:panelGroup></h:panelGroup> 
                        <h:message for="inMilestoneTyp" styleClass="errorMsg"/>

                        <h:commandButton id="saveMSButton" action="#{uTypController.saveMS()}" 
                                         value="#{msgs.button_save}"/>
                        <h:commandButton id="sucheMSButton" value="#{msgs.button_search}" 
                                         action="#{uTypController.sucheMS()}"/>
                    </h:panelGrid>
                </pf:panel>
            </h:form>
            <h:form id="milestoneSelect">
                <pf:panel header="#{msgs.header_list_milestones}" footer="#{msgs.footer_anzahl_milestones}  #{fn:length(uTypController.milestoneList)}">
                    <pf:dataTable stickyHeader="true"  scrollable="true" scrollHeight="200" 
                                  sortBy="#{ms.milestonetypId.milestonetypId}" sortOrder="ascending"
                                  draggableRows="true" 
                                  style="width: 900px;" value="#{uTypController.milestoneList}" var="ms" >
                        <pf:column  style="width: 6%">
                            <f:facet name="header">#{msgs.header_list_de_select}</f:facet>
                            <h:commandButton value="#{ms.milestoneId}" action="#{uTypController.selectMSOrdered(ms)}" rendered="#{not ms.selected}" />
                            <h:commandButton value="#{msgs.mark_selected}#{ms.milestoneId}" action="#{uTypController.deSelectMSOrdered(ms)}" rendered="#{ms.selected}" />
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 14%">
                            <f:facet name="header">#{msgs.milestone_name}</f:facet>
                            <h:outputText value="#{ms.milestoneName}" rendered="#{not ms.edited}"> </h:outputText>
                            <h:inputText value="#{ms.milestoneName}" size="15" rendered="#{ms.edited}"></h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_alltime}</f:facet>
                            <h:outputText value="#{ms.milestoneAlltime}"  rendered="#{not ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText>
                            <h:inputText value="#{ms.milestoneAlltime}" size="5" rendered="#{ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>

                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_handsontime}</f:facet>
                            <h:outputText value="#{ms.milestoneHandsontime}"  rendered="#{not ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText> 
                            <h:inputText value="#{ms.milestoneHandsontime}" size="5" rendered="#{ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_mannumber}</f:facet>
                            <h:outputText value="#{ms.milestoneMannumber}"  rendered="#{not ms.edited}"> </h:outputText>
                            <h:inputText value="#{ms.milestoneMannumber}" size="3" rendered="#{ms.edited}"> </h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_manhour}</f:facet>
                            <h:outputText value="#{ms.milestoneManhour}"  rendered="#{not ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:outputText>
                            <h:inputText value="#{ms.milestoneManhour}" size="5" rendered="#{ms.edited}">
                                <f:convertDateTime pattern="HH:mm" timeZone="GMT+1"/>
                            </h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 10%">
                            <f:facet name="header">#{msgs.milestone_cost}</f:facet>
                            <h:outputText value="#{ms.milestonecost}"  rendered="#{not ms.edited}"> </h:outputText>
                            <h:inputText value="#{ms.milestonecost}" size="5" rendered="#{ms.edited}"> </h:inputText>
                            <f:facet name="footer">
                                <!-- sort Routine removed -->
                            </f:facet>
                        </pf:column>
                        <pf:column style="width: 20%">
                            <f:facet name="header">#{msgs.milestone_milestonetypId_milestonetypName}</f:facet>
                            <h:outputText value="#{ms.milestonetypId.milestonetypName}" rendered="#{not ms.edited}"> </h:outputText>
                            <h:selectOneMenu id="inMSTyp" value="#{ms.milestonetypId.milestonetypId}" rendered="#{ms.edited}">
                                <f:selectItems value="#{uTypController.alleMilestoneTypenMap}" />
                            </h:selectOneMenu>
                        </pf:column>
                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.button_edit}</f:facet>
                            <h:commandButton value="#{msgs.button_edit}" action="#{uTypController.editMS(ms)}" rendered="#{not ms.edited}"/>
                            <h:commandButton value="#{msgs.button_save}" action="#{uTypController.saveMS(ms)}" rendered="#{ms.edited}"/>
                        </pf:column>
                        <pf:column style="width: 6%">
                            <f:facet name="header">#{msgs.button_delete}</f:facet>
                            <h:commandButton onclick="if (!confirm('#{msgs.milestone_confirm_message}'))
                                        return false" value="#{msgs.button_delete}" action="#{uTypController.deleteMS(ms.milestoneId)}"/>
                        </pf:column>
                    </pf:dataTable>
                </pf:panel>
            </h:form>
        </h:panelGrid>
    </ui:define>
</ui:composition>

